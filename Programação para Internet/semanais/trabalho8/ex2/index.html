<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-CuOF+2SnTUfTwSZjCXf01h7uYhfOBuxIhGKPbfEJ3+FqH/s6cIFN9bGr1HmAg4fQ" crossorigin="anonymous">
    <title>Exercício 2</title>
</head>
<body>
    <div class="container">
        <nav class="navbar navbar-expand-lg bg-light">
            <div class="container-fluid">
                <div class="collapse navbar-collapse">
                    <div class="navbar-nav">
                        <a class="nav-link active" href="#Ex1-recebendo-json1">Ex1-recebendo-json1</a>
                        <a class="nav-link" href="#Ex2-recebendo-json2"> Ex2-recebendo-json2</a>
                        <a class="nav-link" href="#Ex3-enviando-json">Ex3-enviando-json</a>
                    </div>
                </div>
            </div>
        </nav>

        <main>
            <section id="Ex1-recebendo-json1">
                <h3>Ex1-recebendo-json1</h3>
                <p>
                    Usando uma função XMLHttpRequest para enviar uma solicitação GET, neste código, quando um usuário termina de digita um CEP, a função buscaEndereco é chamada com o CEP digitado como seu argumento. A função primeiro verifica se o CEP possui 9 caracteres, caso contrário, retorna sem fazer nada. Se o CEP for válido, a função cria um novo objeto XMLHttpRequest e abre uma solicitação GET para o script busca-endereco.php, passando o CEP como um parâmetro de string de consulta.
                </p>

                <p>
                    Quando a solicitação termina de carregar, a função de eventos onload é chamada. Primeiro, ela verifica o código de status da resposta e, se não for 200, registra uma mensagem de erro e retorna. Se o código de status for 200, a função tentará analisar o texto de resposta como JSON e armazenar o resultado em uma variável endereco. Se isso falhar, ele registra uma mensagem de erro e retorna. Se a análise JSON for bem-sucedida, a função selecionará o elemento de formulário e definirá os valores de seus campos rua, bairro e cidade para os valores correspondentes do objeto endereco. Se ocorrer um erro durante a solicitação, a função onerror é chamada, o que registra uma mensagem de erro. Por fim, o método send é chamado para enviar a solicitação.
                </p>

                <p>
                    A função window.onload é chamada quando a página termina de carregar. Ele configura o onkeyup para o elemento com o ID cep que chama a função buscaEndereco com o valor atual do elemento como seu argumento. Isso significa que sempre que o usuário terminar de digitar no campo de entrada CEP, a função de pesquisa de endereço é chamada completando (se encontrar o ID cep) ou não o endereço.
                </p>
            </section>
            

            <section id="Ex2-recebendo-json2">
                <h3>Ex2-recebendo-json2</h3>
                <p>
                    Também usando uma função XMLHttpRequest para enviar uma solicitação GET para um servidor (busca-endereco.php), este código faz o mesmo que o <a href="#Ex1-recebendo-json1">Ex1-recebendo-json1</a>. Contudo, aqui, ao invés de analisar o texto de resposta como JSON e armazenar o resultado em uma variável endereco, usa-se o responseType. Com o response seguido do responseType sendo determinado como 'json', faz-se a conversão em .JSON diretamente em response. 

                </p>
            </section>

            <section id="Ex3-enviando-json">
                <h3>Ex3-enviando-json</h3>
                <p>
                    Este código envia uma solicitação HTTP POST para o servidor busca-endereco.php. Quando o usuário digita um valor no campo de entrada #cep, o valor é passado para a função buscaEndereco como um argumento, valorCep. A função buscaEndereco verifica se o comprimento de valorCep é igual a 9. Se não for, a função retorna nada. Ele cria um objeto, objetoJS, com três propriedades: cep, email e apikey. Os valores dessas propriedades são valorCep, "fulano@mail.com" e "abcdefg123456", respectivamente no caso desse exemplo. Cria-se um novo objeto XMLHttpRequest, xhr, e abre uma solicitação HTTP POST para busca-endereco.php usando xhr. Em seguida, define o cabeçalho HTTP Content-Type como "application/json" usando xhr.setRequestHeader(). open(). xhr.onload é chamado passando os paramêtros do formulário, selecionando o elemento form e define a propriedade value de suas propriedades rua, bairro e cidade para os valores correspondentes no objeto endereco. JSON aqui foi transformado com parse, diferente do segundo exemplo. Onerror verifica se não problemas de rede e em seguida analisa-se o texto da resposta como JSON e o armazena na variável endereco. Envia-se o objeto objetoJS como uma string formatada em JSON como o corpo da solicitação usando xhr.send(). Por fim, define o onkeyup para o campo de entrada #cep que chama a função buscaEndereco com o valor atual do campo de entrada como um argumento quando o usuário terminar de digitar.
    
                </p>
            </section>
        </main>

    </div>
    
</body>
</html>